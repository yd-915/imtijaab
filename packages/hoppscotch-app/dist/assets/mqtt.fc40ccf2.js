import{_ as A}from"./utils.88b63f0a.js";import{W as P,d as j,_ as F}from"./regex.37aa1252.js";import{f as H,E as z,at as W,au as y,V as I,j as u,g as w,ap as K,dC as d,X as J,ay as X,o as Y,c as Z,w as S,e as o,k as p,v as m,l as s,a1 as ee,m as te,a as E,t as x,a5 as se,aG as oe,dD as ae,dE as le,dF as ne,dG as ie,dH as ce,dI as re,dJ as ue}from"./index.45473f34.js";import"./Tab.vue_vue_type_script_setup_true_lang.417ddf5c.js";import"./lens-actions.b9670b75.js";import"./json.6cb86656.js";import"./newOutline.e71c81be.js";import"./date.bdfa601e.js";const de={class:"sticky top-0 z-10 flex flex-shrink-0 p-4 overflow-x-auto space-x-2 bg-primary"},pe={class:"inline-flex flex-1 space-x-2"},me=["placeholder","disabled"],be={class:"flex space-x-2"},fe=["placeholder"],_e=["placeholder"],ve={class:"flex items-center justify-between p-4"},ge={for:"pubTopic",class:"font-semibold text-secondaryLight"},Ee={class:"flex px-4"},Te=["placeholder"],Ce={class:"flex items-center justify-between p-4"},Ne={for:"mqtt-message",class:"font-semibold text-secondaryLight"},he={class:"flex px-4 space-x-2"},ye=["placeholder"],Se={class:"flex items-center justify-between p-4 mt-4 border-t border-dividerLight"},xe={for:"subTopic",class:"font-semibold text-secondaryLight"},ke={class:"flex px-4 space-x-2"},De=["placeholder"],Ve=H({__name:"mqtt",setup(Ie){const e=z(),k=se(),{subscribeToStream:O}=W(),n=y(le,"",ae),b=y(ie,[],ne),c=y(ue,new re,ce),r=I(c.value.connectionState$,"DISCONNECTED"),f=I(c.value.subscriptionState$,!1),T=u(!0),_=u(""),i=u(""),v=u(""),C=u(""),N=u("");let g;const $=w(()=>_.value!==""&&v.value!==""&&r.value==="CONNECTED"),q=w(()=>i.value!==""&&r.value==="CONNECTED"),L=({data:t})=>{t.url===n.value&&(T.value=t.result)};K(()=>{g=new P,g.addEventListener("message",L),O(c.value.event$,t=>{switch(t==null?void 0:t.type){case"CONNECTING":b.value=[{payload:`${e("state.connecting_to",{name:n.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"CONNECTED":b.value=[{payload:`${e("state.connected_to",{name:n.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],k.success(`${e("state.connected")}`);break;case"MESSAGE_SENT":d({prefix:`${t.message.topic}`,payload:t.message.message,source:"client",ts:Date.now()});break;case"MESSAGE_RECEIVED":d({prefix:`${t.message.topic}`,payload:t.message.message,source:"server",ts:t.time});break;case"SUBSCRIBED":d({payload:f.value?`${e("state.subscribed_success",{topic:i.value})}`:`${e("state.unsubscribed_success",{topic:i.value})}`,source:"server",ts:t.time});break;case"SUBSCRIPTION_FAILED":d({payload:f.value?`${e("state.subscribed_failed",{topic:i.value})}`:`${e("state.unsubscribed_failed",{topic:i.value})}`,source:"server",ts:t.time});break;case"ERROR":d({payload:V(t.error),source:"info",color:"#ff5555",ts:t.time});break;case"DISCONNECTED":d({payload:e("state.disconnected_from",{name:n.value}).toString(),source:"info",color:"#ff5555",ts:t.time}),k.error(`${e("state.disconnected")}`);break}})});const R=j(function(){g.postMessage({type:"ws",url:n.value})},1e3);J(n,t=>{t&&R()}),X(()=>{g.terminate()});const D=()=>{if(r.value==="DISCONNECTED")return c.value.connect(n.value,C.value,N.value);c.value.disconnect()},M=()=>{var t;(t=c.value)==null||t.publish(_.value,v.value)},U=()=>{f.value?c.value.unsubscribe(i.value):c.value.subscribe(i.value)},V=t=>{if(typeof t=="string")return t;switch(t.type){case"CONNECTION_NOT_ESTABLISHED":return e("state.connection_lost").toString();case"SUBSCRIPTION_FAILED":return e("state.mqtt_subscription_failed",{topic:t.topic}).toString();case"PUBLISH_ERROR":return e("state.publish_error",{topic:t.topic}).toString();case"CONNECTION_LOST":return e("state.connection_lost").toString();case"CONNECTION_FAILED":return e("state.connection_failed").toString();default:return e("state.disconnected_from",{name:n.value}).toString()}},B=()=>{b.value=[]};return(t,a)=>{const h=oe,G=F,Q=A;return Y(),Z(Q,{"layout-id":"mqtt"},{primary:S(()=>[o("div",de,[o("div",pe,[p(o("input",{id:"mqtt-url","onUpdate:modelValue":a[0]||(a[0]=l=>ee(n)?n.value=l:null),type:"url",autocomplete:"off",spellcheck:"false",class:"w-full px-4 py-2 border rounded bg-primaryLight border-divider text-secondaryDark",placeholder:s(e)("mqtt.url"),disabled:s(r)==="CONNECTED"||s(r)==="CONNECTING",onKeyup:a[1]||(a[1]=te(l=>T.value?D():null,["enter"]))},null,40,me),[[m,s(n)]]),E(h,{id:"connect",disabled:!T.value,class:"w-32",label:s(r)==="CONNECTING"?s(e)("action.connecting"):s(r)==="DISCONNECTED"?s(e)("action.connect"):s(e)("action.disconnect"),loading:s(r)==="CONNECTING",onClick:D},null,8,["disabled","label","loading"])]),o("div",be,[p(o("input",{id:"mqtt-username","onUpdate:modelValue":a[2]||(a[2]=l=>C.value=l),type:"text",spellcheck:"false",class:"input",placeholder:s(e)("authorization.username")},null,8,fe),[[m,C.value]]),p(o("input",{id:"mqtt-password","onUpdate:modelValue":a[3]||(a[3]=l=>N.value=l),type:"password",spellcheck:"false",class:"input",placeholder:s(e)("authorization.password")},null,8,_e),[[m,N.value]])])])]),secondary:S(()=>[E(G,{title:s(e)("mqtt.log"),log:s(b),onDelete:a[4]||(a[4]=l=>B())},null,8,["title","log"])]),sidebar:S(()=>[o("div",ve,[o("label",ge,x(s(e)("mqtt.topic")),1)]),o("div",Ee,[p(o("input",{id:"pubTopic","onUpdate:modelValue":a[5]||(a[5]=l=>_.value=l),class:"input",placeholder:s(e)("mqtt.topic_name"),type:"text",autocomplete:"off",spellcheck:"false"},null,8,Te),[[m,_.value]])]),o("div",Ce,[o("label",Ne,x(s(e)("mqtt.communication")),1)]),o("div",he,[p(o("input",{id:"mqtt-message","onUpdate:modelValue":a[6]||(a[6]=l=>v.value=l),class:"input",type:"text",autocomplete:"off",placeholder:s(e)("mqtt.message"),spellcheck:"false"},null,8,ye),[[m,v.value]]),E(h,{id:"publish",name:"get",disabled:!s($),label:s(e)("mqtt.publish"),onClick:M},null,8,["disabled","label"])]),o("div",Se,[o("label",xe,x(s(e)("mqtt.topic")),1)]),o("div",ke,[p(o("input",{id:"subTopic","onUpdate:modelValue":a[7]||(a[7]=l=>i.value=l),type:"text",autocomplete:"off",placeholder:s(e)("mqtt.topic_name"),spellcheck:"false",class:"input"},null,8,De),[[m,i.value]]),E(h,{id:"subscribe",name:"get",disabled:!s(q),label:s(f)?s(e)("mqtt.unsubscribe"):s(e)("mqtt.subscribe"),reverse:"",onClick:U},null,8,["disabled","label"])])]),_:1})}}});export{Ve as default};
//# sourceMappingURL=mqtt.fc40ccf2.js.map
