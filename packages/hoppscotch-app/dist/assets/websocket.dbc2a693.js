import{_ as ee}from"./utils.88b63f0a.js";import{W as te,d as oe,_ as ae}from"./regex.37aa1252.js";import{a as se,_ as ne}from"./Tab.vue_vue_type_script_setup_true_lang.417ddf5c.js";import{f as le,E as ce,at as re,j as w,au as C,g as ie,av as de,aw as ue,V as me,X as L,ap as pe,ax as h,ay as ge,o as O,c as ve,w as m,e as n,k as d,v as V,l as e,a1 as M,N as R,m as _e,a as l,t as G,az as fe,aA as be,K as ye,aB as Ce,d as he,s as ke,a5 as Se,a2 as Ee,aC as we,aD as Ne,aE as xe,aF as $e,aG as De,x as Ie,z as Te,aH as Pe,aI as We,aJ as Le,aK as Oe,aL as Ve,aM as Me,aN as Re}from"./index.45473f34.js";import{_ as Ge}from"./Communication.vue_vue_type_script_setup_true_lang.678a273b.js";import{I as z}from"./check-circle.65af11ff.js";import{d as ze,I as Be}from"./vuedraggable.umd.e8936d52.js";import"./lens-actions.b9670b75.js";import"./json.6cb86656.js";import"./newOutline.e71c81be.js";import"./date.bdfa601e.js";import"./json.287152ff.js";import"./TaskOption.0cc1241a.js";import"./files.cc1d7fdc.js";const Ue={class:"sticky top-0 z-10 flex flex-shrink-0 p-4 overflow-x-auto space-x-2 bg-primary"},je={class:"inline-flex flex-1 space-x-2"},Ae=["placeholder","disabled"],Ke={class:"sticky z-10 flex items-center justify-between pl-4 border-b bg-primary border-dividerLight top-upperSecondaryStickyFold"},Fe={class:"font-semibold text-secondaryLight"},He={class:"flex"},Je={class:"flex border-b divide-x divide-dividerLight border-dividerLight draggable-content group"},Xe=["onUpdate:modelValue","placeholder","onChange"],qe={key:0,class:"flex flex-col items-center justify-center p-4 text-secondaryLight"},Qe=["src","alt"],Ye={class:"mb-4 text-center"},gt=le({__name:"websocket",setup(Ze){const o=ce(),k=Se(),B=Ee(),{subscribeToStream:U}=re(),N=w("communication"),c=C(We,"",Pe),r=C(Oe,[],Le),S=ie({get(){return r.value.map((t,a)=>({id:`protocol-${a}-${t.value}`,protocol:t}))},set(t){r.value=t.map(({protocol:a})=>a)}}),p=C(ue,new de,Ve),i=me(p.value.connectionState$,"DISCONNECTED"),b=C(Re,[],Me),y=w(!0),x=w([]);let g;L(c,t=>{t&&F()}),L(r,t=>{x.value=t.filter(a=>Object.prototype.hasOwnProperty.call(a,"active")?a.active===!0:!0).map(({value:a})=>a)},{deep:!0});const j=({data:t})=>{t.url===c.value&&(y.value=t.result)},A=t=>t instanceof SyntaxError?t.message:o("error.something_went_wrong").toString();pe(()=>{g=new te,g.addEventListener("message",j),U(p.value.event$,t=>{switch(t==null?void 0:t.type){case"CONNECTING":b.value=[{payload:`${o("state.connecting_to",{name:c.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"CONNECTED":b.value=[{payload:`${o("state.connected_to",{name:c.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],k.success(`${o("state.connected")}`);break;case"MESSAGE_SENT":h({payload:t.message,source:"client",ts:Date.now()});break;case"MESSAGE_RECEIVED":h({payload:t.message,source:"server",ts:t.time});break;case"ERROR":h({payload:A(t.error),source:"info",color:"#ff5555",ts:t.time});break;case"DISCONNECTED":h({payload:o("state.disconnected_from",{name:c.value}).toString(),source:"info",color:"#ff5555",ts:t.time}),k.error(`${o("state.disconnected")}`);break}})}),ge(()=>{g&&g.terminate()});const K=()=>{we()},F=oe(function(){g.postMessage({type:"ws",url:c.value})},1e3),$=()=>{if(i.value==="DISCONNECTED")return p.value.connect(c.value,x.value);p.value.disconnect()},H=t=>{p.value.sendMessage(t)},J=()=>{Ne({value:"",active:!0})},X=t=>{const a=r.value.slice();xe(t),k.success(`${o("state.deleted")}`,{duration:4e3,action:{text:`${o("action.undo")}`,onClick:(I,E)=>{r.value=a,E.goAway()}}})},D=(t,a)=>{$e(t,a)},q=()=>{b.value=[]};return(t,a)=>{const I=De,E=Ge,T=se,v=Ie,Q=ne,Y=ae,Z=ee,_=Te("tippy");return O(),ve(Z,{"layout-id":"websocket"},{primary:m(()=>[n("div",Ue,[n("div",je,[d(n("input",{id:"websocket-url","onUpdate:modelValue":a[0]||(a[0]=s=>M(c)?c.value=s:null),class:R(["w-full px-4 py-2 border rounded bg-primaryLight border-divider text-secondaryDark",{error:!y.value}]),type:"url",autocomplete:"off",spellcheck:"false",placeholder:`${e(o)("websocket.url")}`,disabled:e(i)==="CONNECTED"||e(i)==="CONNECTING",onKeyup:a[1]||(a[1]=_e(s=>y.value?$():null,["enter"]))},null,42,Ae),[[V,e(c)]]),l(I,{id:"connect",disabled:!y.value,class:"w-32",name:"connect",label:e(i)==="CONNECTING"?e(o)("action.connecting"):e(i)==="DISCONNECTED"?e(o)("action.connect"):e(o)("action.disconnect"),loading:e(i)==="CONNECTING",onClick:$},null,8,["disabled","label","loading"])])]),l(Q,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=s=>N.value=s),styles:"sticky bg-primary top-upperPrimaryStickyFold z-10","render-inactive-tabs":""},{default:m(()=>[l(T,{id:"communication",label:`${e(o)("websocket.communication")}`},{default:m(()=>[l(E,{"is-connected":e(i)==="CONNECTED",onSendMessage:a[2]||(a[2]=s=>H(s))},null,8,["is-connected"])]),_:1},8,["label"]),l(T,{id:"protocols",label:`${e(o)("websocket.protocols")}`},{default:m(()=>[n("div",Ke,[n("label",Fe,G(e(o)("websocket.protocols")),1),n("div",He,[d(l(v,{title:e(o)("action.clear_all"),icon:e(fe),onClick:K},null,8,["title","icon"]),[[_,{theme:"tooltip"}]]),d(l(v,{title:e(o)("add.new"),icon:e(be),onClick:J},null,8,["title","icon"]),[[_,{theme:"tooltip"}]])])]),l(e(ze),{modelValue:e(S),"onUpdate:modelValue":a[3]||(a[3]=s=>M(S)?S.value=s:null),"item-key":"id",animation:"250",handle:".draggable-handle",draggable:".draggable-content","ghost-class":"cursor-move","chosen-class":"bg-primaryLight","drag-class":"cursor-grabbing"},{item:m(({element:{protocol:s},index:u})=>{var P,W;return[n("div",Je,[n("span",null,[d(l(v,{icon:e(Be),class:R(["cursor-auto text-primary hover:text-primary",{"draggable-handle group-hover:text-secondaryLight !cursor-grab":u!==((P=e(r))==null?void 0:P.length)-1}]),tabindex:"-1"},null,8,["icon","class"]),[[_,{theme:"tooltip",delay:[500,20],content:u!==((W=e(r))==null?void 0:W.length)-1?e(o)("action.drag_to_reorder"):null}]])]),d(n("input",{"onUpdate:modelValue":f=>s.value=f,class:"flex flex-1 px-4 py-2 bg-transparent",placeholder:`${e(o)("count.protocol",{count:u+1})}`,name:"message",type:"text",autocomplete:"off",onChange:f=>D(u,{value:f.target.value,active:s.active})},null,40,Xe),[[V,s.value]]),n("span",null,[d(l(v,{title:s.hasOwnProperty("active")?s.active?e(o)("action.turn_off"):e(o)("action.turn_on"):e(o)("action.turn_off"),icon:s.hasOwnProperty("active")?s.active?e(z):e(ye):e(z),color:"green",onClick:f=>D(u,{value:s.value,active:!s.active})},null,8,["title","icon","onClick"]),[[_,{theme:"tooltip"}]])]),n("span",null,[d(l(v,{title:e(o)("action.remove"),icon:e(Ce),color:"red",onClick:f=>X(u)},null,8,["title","icon","onClick"]),[[_,{theme:"tooltip"}]])])])]}),_:1},8,["modelValue"]),e(r).length===0?(O(),he("div",qe,[n("img",{src:`/images/states/${e(B).value}/add_category.svg`,loading:"lazy",class:"inline-flex flex-col object-contain object-center w-16 h-16 my-4",alt:`${e(o)("empty.protocols")}`},null,8,Qe),n("span",Ye,G(e(o)("empty.protocols")),1)])):ke("",!0)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),secondary:m(()=>[l(Y,{title:e(o)("websocket.log"),log:e(b),onDelete:a[5]||(a[5]=s=>q())},null,8,["title","log"])]),_:1})}}});export{gt as default};
//# sourceMappingURL=websocket.dbc2a693.js.map
